#pragma once
#include "defines.h"

class GameX
{
private:
	//GLFWwindow* window;
	void* window;
	string title_;
	int cx_,cy_;
	int width_,height_;
	//float ratio_;
	int maxfps_;
	int upTime_;//毫秒单位
	map<string,Texture*> TexMap;
	RGBAData color1,color2,color3,color4;

	//FreeType
	FT_Library pFTLib;
	FT_Face    pFTFace;

	//int _argc;char** _argv;
private:
		bool Init();
		bool CreateWnd();
		bool InitFreeType();
		GLuint LoadChar(wchar_t);
		//void MakeCharList();
public:
	Texture * LoadTexture(string filename);

	// 绘制图像
	// 四色顶点按坐象限号排序
	
	void SetColor(RGBAData _color = RGBAData());
	void SetColor(RGBAData _color1,RGBAData _color2,RGBAData _color3,RGBAData _color4);

	void Draw(string filename,Rect drawRect,float ox = 0,float oy = 0,float angle = 0);
	void Draw(string filename,Rect drawRect,Rect srcRect,float ox = 0,float oy = 0,float angle = 0);
	void Draw(string filename,int x,int y,Rect srcRect,float ox = 0,float oy = 0,float angle = 0);
	void Draw(string filename,int x,int y,float ox = 0,float oy = 0,float angle = 0);

	void Draw(Texture *tex,Rect drawRect,float ox = 0,float oy = 0,float angle = 0);
	void Draw(Texture *tex,int x,int y,Rect srcRect,float ox = 0,float oy = 0,float angle = 0);
	void Draw(Texture *tex,int x,int y,float ox = 0,float oy = 0,float angle = 0);

	void Draw(Texture *tex,Rect drawRectI,Rect srcRectI,float ox = 0,float oy = 0,float angle = 0);

	/* 手动渲染处理 */
	//每次调用Opengl函数后用Render()是个好习惯，恢复了GameX的2D模式 >o<
	void Render();

	// 绘制文字
	void Text(string text,int x,int y,float ox = 0,float oy = 0,float angle = 0);
	//void Text(string text,Rect drawRect);

public:
	void Run();

	virtual void Update() = 0;

	GameX(string title, int cx, int cy, int maxfps =60);//,int argc, char *argv[]);
	~GameX(void);
};
